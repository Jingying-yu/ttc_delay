---
title: "Choosing TTC x Provides the Most Time Stability during Rush Hours"
subtitle: "Analysis on the Delay Magnitude of different TTC Services"
author: 
  - Sandy Yu
thanks: "Code and data are available at: https://github.com/Jingying-yu/ttc_delay.git"
date: today
date-format: long
abstract: ""
format: pdf
toc: true
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(dplyr)
library(lubridate)
library(zoo)
library(knitr)
library(ggplot2)
```


# Introduction



Analyses and findings in this paper are structured into several sections: @sec-data -- Data, @sec-results -- Results, and @sec-discussion -- Discussion. The Data section introduces the context of the datasets and examines all datasets and variables kept for analysis. The Result section focuses on visualizing and presenting the data results in Data section. The Discussion section further evaluate the implications behind the data results presented in the previous section, expands the topic beyond pure data, and touches on any weaknesses and next steps.


# Data {#sec-data}




## TTC Bus Delay



```{r}
#| label: tbl-bus-delay
#| tbl-cap: Sample of Cleaned TTC Bus Delay Dataset
#| echo: false

bus_delay <- read.csv(here::here("inputs/data/cleaned_data/bus_delay.csv"))

sample_bus_delay <- head(bus_delay, n = 3)

knitr::kable(sample_bus_delay, col.names = c("Date", "Line", "Time", "Day", "Location", "Cause of Delay", "Min Delayed", "Min Gap", "Direction", "Vehicle"), align = c("l","c", "c", "c", "c","c", "c", "c", "c","c"))
```


## TTC Streetcar Delay


```{r}
#| label: tbl-streetcar-delay
#| tbl-cap: Sample of Cleaned TTC Streetcar Delay Dataset
#| echo: false

streetcar_delay <- read.csv(here::here("inputs/data/cleaned_data/streetcar_delay.csv"))

sample_streetcar_delay <- head(streetcar_delay, n = 3)

knitr::kable(sample_streetcar_delay, col.names = c("Date", "Line", "Time", "Day", "Location", "Cause of Delay", "Min Delayed", "Min Gap", "Bound", "Vehicle"), align = c("l","c", "c", "c", "c","c", "c", "c", "c","c"))
```


## TTC Subway Delay

### Delay Code
```{r}
#| label: tbl-subway-code
#| tbl-cap: Sample of TTC Subway Delay Code
#| echo: false
#| message: false

subway_delay_code <- read.csv(here::here("inputs/data/cleaned_data/subway_delay_code.csv"))

sample_subway_delay_code <- head(subway_delay_code, n = 3)

knitr::kable(sample_subway_delay_code, col.names = c("Code", "Code Description"), align = c("c","c"))
```

### Delay Data
```{r}
#| label: tbl-subway-delay
#| tbl-cap: Sample of Cleaned TTC Subway Delay Dataset
#| echo: false
#| message: false

subway_delay <- read.csv(here::here("inputs/data/cleaned_data/subway_delay.csv"))

sample_subway_delay <- head(subway_delay, n = 3)

knitr::kable(sample_subway_delay, col.names = c("Date", "Time", "Day", "Location", "Delay Code", "Min Delayed", "Min Gap", "Bound", "Line", "Vehicle"), align = c("l","c", "c", "c", "c","c", "c", "c", "c","c"))
```

## TTC Delay Comparision



# Results {#sec-result}



## Highest Number of Total Delayed

```{r}
#| label: fig-coded
#| fig-cap: Visualization to show correlation between number of Calls Coded (represented by the red line) and Homeless Death Counts (represented by the blue line)
#| echo: false
#| message: false

combined_data <- read_csv(here::here("outputs/data/combined_data.csv"),
                          show_col_types = FALSE)


combined_data|> ggplot(mapping = aes(x = Month, y = Death_Count)) + 
  geom_point() + geom_smooth() + 
  geom_line(aes(x = Month, y = Calls_Coded_month/1000), color = "red") +
  labs(
    title = "Calls Coded & Homeless Death Count",
    x = "Time (in Month)",
    y = "Count"
  )
#still need to add a legend or label, but I haven't yep figured out how
```

## Most Delayed during Weekday
Define Rush Hours

Present Results During Rush Hours & at Off-Peak Hours
```{r}
#| label: fig-referred
#| fig-cap: Visualization to show correlation between number of callers referred to shelter (represented by the purple line) and Homeless Death Counts (represented by the blue line)
#| echo: false
#| message: false

combined_data <- read_csv(here::here("outputs/data/combined_data.csv"),
                          show_col_types = FALSE)


combined_data|> ggplot(mapping = aes(x = Month, y = Death_Count)) + 
  geom_point() + geom_smooth() + 
  geom_line(aes(x = Month, y = Referral_to_Shelter_month/100), color = "purple") +
  labs(
    title = "Callers Referred to Shelter & Homeless Death",
    x = "Time (in Month)",
    y = "Count"
  )
#still need to add a legend or label, but I haven't yep figured out how
```



## Most Delayed during Weekends

```{r}
#| label: fig-informed
#| fig-cap: Visualization to show correlation between number of callers given information on homelessness prevention (represented by the dark green line) and Homeless Death Counts (represented by the blue line)
#| echo: false
#| message: false

combined_data <- read_csv(here::here("outputs/data/combined_data.csv"),
                          show_col_types = FALSE)


combined_data|> ggplot(mapping = aes(x = Month, y = Death_Count)) + 
  geom_point() + geom_smooth() + 
  geom_line(aes(x = Month, y = Information_Homelessness_and_Prevention_month/100), color = "darkgreen") +
  labs(
    title = "Callers given Info on Homeless Prevention vs Homeless Death",
    x = "Time (in Month)",
    y = "Count"
  )
#still need to add a legend or label, but I haven't yep figured out how
```

## Most Popular Delay Reasons
- 1 table for all three services

## Most Popular Delayed Vehicles
- 1 table for all three services



# Discussion {#sec-discussion}

## TTC Service Prices {#sec-price}
- one-fare

## Correlation between Delay and Direction of Travel
- Financial District
- Midtown Direction

## TTC Service Amenities
- The PATH (for financial district)
- AC in Summer & Winter

## Errors in analysis, Limitations and Next Steps





# Conclusion {#sec-conclusion}






\newpage


# References


