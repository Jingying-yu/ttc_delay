---
title: "Choosing TTC x Provides the Most Time Stability during Rush Hours"
subtitle: "Analysis on the Delay Magnitude of different TTC Services"
author: 
  - Sandy Yu
thanks: "Code and data are available at: https://github.com/Jingying-yu/ttc_delay.git"
date: today
date-format: long
abstract: ""
format: pdf
toc: true
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false
# load librarys and datasets
library(tidyverse)
library(dplyr)
library(lubridate)
library(zoo)
library(knitr)
library(ggplot2)
library(hms)

bus_delay <- read.csv(here::here("inputs/data/cleaned_data/bus/bus_delay.csv"))
streetcar_delay <- read.csv(here::here("inputs/data/cleaned_data/streetcar/streetcar_delay.csv"))
subway_delay <- read.csv(here::here("inputs/data/cleaned_data/subway/subway_delay.csv"))
subway_delay_code <- read.csv(here::here("inputs/data/cleaned_data/subway_delay_code.csv"))

```


# Introduction



Analyses and findings in this paper are structured into several sections: @sec-data -- Data, @sec-results -- Results, and @sec-discussion -- Discussion. The Data section introduces the context of the datasets and examines all datasets and variables kept for analysis. The Result section focuses on visualizing and presenting the data results in Data section. The Discussion section further evaluate the implications behind the data results presented in the previous section, expands the topic beyond pure data, and touches on any weaknesses and next steps.


# Data {#sec-data}




## TTC Bus Delay



```{r}
#| label: tbl-bus-delay
#| tbl-cap: Sample of Cleaned TTC Bus Delay Dataset
#| echo: false

sample_bus_delay <- head(bus_delay, n = 3)

knitr::kable(sample_bus_delay, col.names = c("Date", "Line", "Time", "Day", "Location", "Cause of Delay", "Min Delayed", "Min Gap", "Direction", "Vehicle"), align = c("l","c", "c", "c", "c","c", "c", "c", "c","c"))
```


## TTC Streetcar Delay


```{r}
#| label: tbl-streetcar-delay
#| tbl-cap: Sample of Cleaned TTC Streetcar Delay Dataset
#| echo: false

sample_streetcar_delay <- head(streetcar_delay, n = 3)

knitr::kable(sample_streetcar_delay, col.names = c("Date", "Line", "Time", "Day", "Location", "Cause of Delay", "Min Delayed", "Min Gap", "Bound", "Vehicle"), align = c("l","c", "c", "c", "c","c", "c", "c", "c","c"))
```


## TTC Subway Delay

### Delay Code
```{r}
#| label: tbl-subway-code
#| tbl-cap: Sample of TTC Subway Delay Code
#| echo: false
#| message: false

sample_subway_delay_code <- head(subway_delay_code, n = 3)

knitr::kable(sample_subway_delay_code, col.names = c("Code", "Code Description"), align = c("c","c"))
```

### Delay Data
```{r}
#| label: tbl-subway-delay
#| tbl-cap: Sample of Cleaned TTC Subway Delay Dataset
#| echo: false
#| message: false

sample_subway_delay <- head(subway_delay, n = 3)

knitr::kable(sample_subway_delay, col.names = c("Date", "Time", "Day", "Location", "Delay Code", "Min Delayed", "Min Gap", "Bound", "Line", "Vehicle"), align = c("l","c", "c", "c", "c","c", "c", "c", "c","c"))
```

## TTC Delay Comparision



# Results {#sec-result}



## Highest Number of Total Delayed

```{r}
#| label: fig-total-delay
#| fig-cap: Visualization to show the TTC service that has the highest number of delays in year 2023
#| echo: false
#| message: false
#construct appropriate table for visualization
service_type <- c("bus", "streetcar", "subway")
num_delay <- c(nrow(bus_delay), nrow(streetcar_delay), nrow(subway_delay))

delay_count <- data.frame(service_type, num_delay)

# Generate the bar plot
ggplot(delay_count, aes(x = service_type, y = num_delay, fill = service_type)) +
  geom_bar(stat = "identity") + 
  geom_text(aes(label = paste0(num_delay, " delayed")), 
          vjust = 1, color = "white", size = 3.5, position = position_stack(vjust = 0.55)) +
  labs(title = "Number of Delays by Service Type", x = "Service Type", y = "Number of Delays", fill = "Service Type") +  # Label the axes
  theme_minimal()  # Apply a minimal theme
```

## Most Delayed during Weekday
Define Rush Hours:
  Rush Hours: 
  •	Morning Rush-Hour: Approximately 7:00 AM to 9:00 AM
	•	Evening Rush-Hour: Approximately 4:00 PM to 7:00 PM

Present Results During Rush Hours & at Off-Peak Hours

```{r}
#| echo: false
#| message: false
weekday_bus_delay <- read.csv(here::here("inputs/data/cleaned_data/bus/bus_delay.csv"))
weekday_streetcar_delay <- read.csv(here::here("inputs/data/cleaned_data/streetcar/streetcar_delay.csv"))
weekday_subway_delay <- read.csv(here::here("inputs/data/cleaned_data/subway/subway_delay.csv"))
```


```{r}
#| label: fig-weekday
#| fig-cap: Visualization to show the total delayed time during weekdays in 2023
#| echo: false
#| message: false

service_type <- c("bus", "streetcar", "subway")
sum_delay_time <- c(sum(weekday_bus_delay$min_delay), sum(weekday_streetcar_delay$min_delay), sum(weekday_subway_delay$min_delay))

total_delay_time <- data.frame(service_type, as.numeric(sum_delay_time))

# Generate the bar plot
ggplot(total_delay_time, aes(x = service_type, y = sum_delay_time, fill = service_type)) +
  geom_bar(stat = "identity") + 
  # Add labels for total hours
  geom_text(aes(label = paste0(round(sum_delay_time / 60, 2), " hours")), 
            vjust = 1, color = "white", size = 3.5, position = position_stack(vjust = 0.55)) +  
  labs(title = "Total Minutes Delayed in 2023 during Weekdays", 
       x = "Service Type", y = "Total Delayed (min)", fill = "Service Type") +  # Label the axes
  theme_minimal()

```

## Most Delayed during Rush-Hours & Off-Peak Hours

```{r}
#| label: fig-rush-off
#| fig-cap: Horizontal Barplot used to visualize the longest average delay time for different TTC services during Rush-Hours and Off-Peak Hours
#| echo: false
#| message: false



```

## Most Popular Delay Reasons
- 1 table for all three services
- separate into rush & off-peak hours

## Most Popular Delayed Vehicles
- 1 table for all three services
- separate into rush & off-peak hours


# Discussion {#sec-discussion}

## TTC Service Prices {#sec-price}
- one-fare

## Correlation between Delay and Direction of Travel
- Financial District
- Midtown Direction

## TTC Service Amenities
- The PATH (for financial district)
- AC in Summer & Winter

## Errors in analysis, Limitations and Next Steps





# Conclusion {#sec-conclusion}






\newpage


# References


